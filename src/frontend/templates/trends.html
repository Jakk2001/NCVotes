<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Registration Trends - NC Elections Transparency Project</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <style>
        .trend-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(500px, 1fr));
            gap: 2rem;
            margin: 2rem 0;
        }
        
        .trend-card {
            background: white;
            border-radius: 8px;
            padding: 1.5rem;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .trend-card h3 {
            margin-top: 0;
            color: #2c3e50;
            border-bottom: 2px solid #634ea3;
            padding-bottom: 0.5rem;
        }
        
        .chart-container {
            width: 100%;
            height: 600px;
            border: 1px solid #e0e0e0;
            border-radius: 4px;
            overflow: hidden;
        }
        
        .chart-container iframe {
            width: 100%;
            height: 100%;
            border: none;
        }
        
        .section-divider {
            margin: 3rem 0;
            border-top: 3px solid #634ea3;
            position: relative;
        }
        
        .section-divider h2 {
            background: white;
            display: inline-block;
            padding: 0 1rem;
            position: relative;
            top: -1.2rem;
            color: #634ea3;
        }
        
        .full-width-card {
            grid-column: 1 / -1;
        }
    </style>
</head>
<body>
    <nav>
        <div class="container">
            <a href="{{ url_for('index') }}" class="logo">NC ELECTIONS TRANSPARENCY</a>
            <ul class="nav-links">
                <li><a href="{{ url_for('index') }}#about">About</a></li>
                <li><a href="{{ url_for('index') }}#data">Data</a></li>
                <li><a href="{{ url_for('voting_info') }}">Voting Info</a></li>
            </ul>
        </div>
    </nav>

    <header class="page-header">
        <div class="container">
            <div class="breadcrumb">
                <a href="{{ url_for('index') }}">‚Üê Back to Home</a>
            </div>
            <h1>Registration Trends</h1>
            <p class="tagline">Track how North Carolina's electorate has evolved over time</p>
        </div>
    </header>

    <main>
        <section class="detail-section">
            <div class="container">

                <!-- Add this section after the page header and before the trend charts -->

                {% if stats %}
                <section class="key-stats-section">
                    <div class="container">
                        <div class="section-divider">
                            <h1>Key Statistics</h1>
                        </div>
                        
                        <div class="stats-intro">
                            <p>Track new voter registrations and demographic trends across time. These metrics show how many new voters have registered since key dates.</p>
                        </div>

                         
                        <div class="stat-note">
                            {% if last_updated %}
                            <p style="color: #525252; font-size: 1rem; margin-top: 2rem;">
                                <strong>Data Last Updated:</strong> {{ last_updated.strftime('%B %d, %Y at %I:%M %p') }}
                            </p>
                            {% endif %}
                        </div>


                        <!-- Current Total -->
                        <div class="stats-summary" style="margin-bottom: 2rem;">
                            <p><strong>Current Total of Registered Voters:</strong> {{ '{:,}'.format(stats.current_total) }}</p>
                        </div>
                       
                        <!-- New Registrations by Period -->
                        <div class="stat-category">
                            <h3>New Registrations by Timeframe</h3>
                            <div class="stat-table-wrapper">
                                <table class="stat-table">
                                    <thead>
                                        <tr>
                                            <th>Since</th>
                                            <th>New Registrations</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for period, count in stats.new_registrations.items() %}
                                        <tr>
                                            <td>{{ period.replace('_', ' ').title() }}</td>
                                            <td>{{ '{:,}'.format(count) }}</td>
                                        </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        <!-- Party Breakdown of New Registrations -->
                        <div class="stat-category">
                            <h3>New Registrations by Party</h3>
                            <p class="stat-note">Party affiliation of voters who registered in each timeframe</p>
                            
                            <div class="stat-table-wrapper">
                                <table class="stat-table">
                                    <thead>
                                        <tr>
                                            <th>Party</th>
                                            {% for period in stats.party_new_regs %}
                                            <th>{{ period.replace('_', ' ').title() }}</th>
                                            {% endfor %}
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% set ns = namespace(parties=[]) %}
                                        {% for period, parties in stats.party_new_regs.items() %}
                                            {% for party in parties %}
                                                {% if party.party not in ns.parties %}
                                                    {% set ns.parties = ns.parties + [party.party] %}
                                                {% endif %}
                                            {% endfor %}
                                        {% endfor %}
                                        
                                        {% for party_name in ns.parties %}
                                        <tr>
                                            <td>{{ party_name }}</td>
                                            {% for period, parties in stats.party_new_regs.items() %}
                                                {% set ns.found = 0 %}
                                                {% for party in parties %}
                                                    {% if party.party == party_name %}
                                                        {% set ns.found = party.total %}
                                                    {% endif %}
                                                {% endfor %}
                                                <td>{{ '{:,}'.format(ns.found) }}</td>
                                            {% endfor %}
                                        </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        
                        <!-- Age Group Breakdown of New Registrations -->
                        <div class="stat-category">
                            <h3>New Registrations by Age Group</h3>
                            <p class="stat-note">Age group distribution of voters who registered in each timeframe</p>
                            
                            <div class="stat-table-wrapper">
                                <table class="stat-table">
                                    <thead>
                                        <tr>
                                            <th>Age Group</th>
                                            {% for period in stats.age_new_regs %}
                                            <th>{{ period.replace('_', ' ').title() }}</th>
                                            {% endfor %}
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% set ns = namespace(groups=[]) %}
                                        {% for period, groups in stats.age_new_regs.items() %}
                                            {% for group in groups %}
                                                {% if group.age_group not in ns.groups %}
                                                    {% set ns.groups = ns.groups + [group.age_group] %}
                                                {% endif %}
                                            {% endfor %}
                                        {% endfor %}
                                        
                                        {% for group_name in ns.groups %}
                                        <tr>
                                            <td>{{ group_name }}</td>
                                            {% for period, groups in stats.age_new_regs.items() %}
                                                {% set ns.found = 0 %}
                                                {% for group in groups %}
                                                    {% if group.age_group == group_name %}
                                                        {% set ns.found = group.total %}
                                                    {% endif %}
                                                {% endfor %}
                                                <td>{{ '{:,}'.format(ns.found) }}</td>
                                            {% endfor %}
                                        </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                        </div>

                         <!-- Gender Breakdown of New Registrations -->
                        <div class="stat-category">
                            <h3>New Registrations by Gender</h3>
                            <p class="stat-note">Gender distribution of voters who registered in each timeframe</p>
                            
                            <div class="stat-table-wrapper">
                                <table class="stat-table">
                                    <thead>
                                        <tr>
                                            <th>Gender</th>
                                            {% for period in stats.gender_new_regs %}
                                            <th>{{ period.replace('_', ' ').title() }}</th>
                                            {% endfor %}
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% set ns = namespace(genders=[]) %}
                                        {% for period, genders in stats.gender_new_regs.items() %}
                                            {% for g in genders %}
                                                {% if g.gender not in ns.genders %}
                                                    {% set ns.genders = ns.genders + [g.gender] %}
                                                {% endif %}
                                            {% endfor %}
                                        {% endfor %}
                                        
                                        {% for gender_name in ns.genders %}
                                        <tr>
                                            <td>{{ gender_name }}</td>
                                            {% for period, genders in stats.gender_new_regs.items() %}
                                                {% set ns.found = 0 %}
                                                {% for g in genders %}
                                                    {% if g.gender == gender_name %}
                                                        {% set ns.found = g.total %}
                                                    {% endif %}
                                                {% endfor %}
                                                <td>{{ '{:,}'.format(ns.found) }}</td>
                                            {% endfor %}
                                        </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                        </div>
        
                    </section> 
                    {% endif %}

                       

                <style>
                .key-stats-section {
                    background: #f8f9fa;
                    padding: 3rem 0;
                    margin: 2rem 0;
                }

                .stats-intro {
                    margin: 1.5rem 0 2rem 0;
                    font-size: 1.05rem;
                    color: #555;
                }

                .stat-category {
                    background: white;
                    border-radius: 8px;
                    padding: 1.5rem;
                    margin: 2rem 0;
                    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
                }

                .stat-category h3 {
                    color: #634ea3;
                    margin-top: 0;
                    margin-bottom: 0.5rem;
                    border-bottom: 2px solid #634ea3;
                    padding-bottom: 0.5rem;
                }

                .stat-note {
                    font-size: 0.9rem;
                    color: #666;
                    font-style: italic;
                    margin: 0.5rem 0 1rem 0;
                }

                .period-group {
                    margin: 1.5rem 0;
                }

                .period-group h4 {
                    color: #2c3e50;
                    margin-bottom: 0.75rem;
                    font-size: 1rem;
                }

                .stat-table-wrapper {
                    overflow-x: auto;
                }

                .stat-table {
                    width: 100%;
                    border-collapse: collapse;
                    margin: 0;
                }

                .stat-table thead {
                    background: #634ea3;
                    color: white;
                }

                .stat-table th {
                    padding: 0.75rem;
                    text-align: left;
                    font-weight: 600;
                }

                .stat-table td {
                    padding: 0.75rem;
                    border-bottom: 1px solid #ddd;
                }

                .stat-table tbody tr:hover {
                    background: #f5f5f5;
                }

                .stats-summary {
                    background: #634ea3;
                    color: white;
                    padding: 1rem;
                    border-radius: 8px;
                    text-align: center;
                    font-size: 1.1rem;
                }

                @media (max-width: 768px) {
                    .stat-table {
                        font-size: 0.85rem;
                    }
                    
                    .stat-table th,
                    .stat-table td {
                        padding: 0.5rem;
                    }
                }
                </style>


                <div class="section-divider">
                    <h1>Overall Trends</h1>
                </div>

                <div class="trend-grid">
                    <div class="trend-card full-width-card">
                        <h3>Cumulative Registration Growth</h3>
                        <div class="chart-container">
                            <iframe src="{{ url_for('serve_chart', filename='cumulative_registration.html') }}" 
                                    title="Cumulative Registration"></iframe>
                        </div>
                    </div>

                    <div class="trend-card full-width-card">
                        <h3>Weekly Registration Activity</h3>
                        <div class="chart-container">
                            <iframe src="{{ url_for('serve_chart', filename='weekly_registrations.html') }}" 
                                    title="Weekly Registrations"></iframe>
                        </div>
                    </div>
                </div>
                
                <div class="insight-box" style="margin-top: 1rem;">
                            <h2>What's going on in October?</h2>
                            <h4>
                                You may notice that almost every year, typically in the first and last week of October, there are large 
                                increases in voter registrations. This is due to two election-related deadlines:
                            </h4>
                            <ul>
                                <li>The first is North Carolina's 
                                    registration deadline, which occurs 25 days before election day - typically around October 8-12. There are a lot 
                                    of voter registrations that week as final registration drives push to get voters registered before the deadline.
                                </li>
                                
                                <li>
                                    The second is the end of Early Voting, which typically falls on the last weekend of October. 
                                    While North Carolina's voter registration deadline is 25 days before an election, that does not apply to same-day registration: 
                                    registering to vote at the polling site just before casting a ballot.
                                    This second 'jump' in registrations are likely same-day registrants being added to the voter file during early voting.
                                </li>
                            </ul>
                        </div>

                <div class="section-divider">
                    <h1>Demographic Trends</h1>
                </div>

                <div class="trend-grid">
                    <div class="trend-card full-width-card">
                        <h3>Party Affiliation Over Time</h3>
                        <div class="chart-container">
                            <iframe src="{{ url_for('serve_chart', filename='party_trends.html') }}" 
                                    title="Party Trends"></iframe>
                        </div>
                        <div class="insight-box" style="margin-top: 1rem;">
                            <p>
                                Track how party registration has evolved, showing the growth of 
                                Democrats, Republicans, and Unaffiliated voters over time. This 
                                reveals long-term shifts in political affiliation patterns.
                            </p>
                        </div>
                    </div>

                    <div class="trend-card full-width-card">
                        <h3>Age Group Patterns Over Time</h3>
                        <div class="chart-container">
                            <iframe src="{{ url_for('serve_chart', filename='age_group_trends.html') }}" 
                                    title="Age Group Trends"></iframe>
                        </div>
                        <div class="insight-box" style="margin-top: 1rem;">
                            <p>
                                Compare registration growth across age cohorts. Younger voters 
                                (18-25) often show spikes during election years, while older 
                                age groups maintain steadier growth patterns.
                            </p>
                        </div>
                    </div>

                    <div class="trend-card full-width-card">
                        <h3>Gender Distribution Over Time</h3>
                        <div class="chart-container">
                            <iframe src="{{ url_for('serve_chart', filename='gender_trends.html') }}" 
                                    title="Gender Trends"></iframe>
                        </div>
                        <div class="insight-box" style="margin-top: 1rem;">
                            <p>
                                Examine how male and female registration has grown over time. 
                                Gender participation patterns can reveal insights into civic 
                                engagement across demographic groups.
                            </p>
                        </div>
                    </div>

                    <div class="trend-card full-width-card">
                        <h3>Racial Demographics Over Time</h3>
                        <div class="chart-container">
                            <iframe src="{{ url_for('serve_chart', filename='race_trends.html') }}" 
                                    title="Race Trends"></iframe>
                        </div>
                        <div class="insight-box" style="margin-top: 1rem;">
                            <p>
                                Track registration growth across racial categories, revealing 
                                how North Carolina's electorate has become more diverse over 
                                time and identifying potential gaps in registration outreach.
                            </p>
                        </div>
                    </div>
                </div>

            </div>
        </section>
    </main>

    <footer>
        <div class="container">
            <p>
                Data source: 
                <a href="https://www.ncsbe.gov/" target="_blank" rel="noopener">
                    NC State Board of Elections
                </a>
            </p>
            <p>&copy; 2026 NC Elections Transparency Project</p>
        </div>
    </footer>
</body>
</html>