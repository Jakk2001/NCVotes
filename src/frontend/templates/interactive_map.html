<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive Map - NC Elections Transparency Project</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <style>
        .layer-selector {
            background: white;
            padding: 2rem;
            margin: 2rem 0;
            border: 2px solid var(--border-color);
        }
        
        .layer-buttons {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
            margin-top: 1rem;
        }
        
        .layer-btn {
            padding: 1rem 2rem;
            font-size: 1.1rem;
            font-weight: 600;
            border: 2px solid var(--border-color);
            background: white;
            color: var(--text-color);
            cursor: pointer;
            transition: all 0.3s;
            text-decoration: none;
            display: inline-block;
        }
        
        .layer-btn:hover {
            background: var(--bg-alt);
            border-color: var(--secondary-color);
        }
        
        .layer-btn.active {
            background: var(--secondary-color);
            color: white;
            border-color: var(--secondary-color);
        }
        
        .map-container {
            background: white;
            padding: 2rem;
            border: 2px solid var(--border-color);
            margin: 2rem 0;
            min-height: 700px;
        }
        
        .map-frame {
            width: 100%;
            height: 700px;
            border: none;
        }
        
        .info-panel {
            background: var(--bg-alt);
            padding: 2rem;
            margin: 2rem 0;
            border-left: 6px solid var(--accent-color);
        }
        
        .feature-list {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 2rem;
            margin: 2rem 0;
        }
        
        .feature-item {
            display: flex;
            align-items: flex-start;
            gap: 1rem;
        }
        
        .feature-icon {
            font-size: 2rem;
            color: var(--secondary-color);
            flex-shrink: 0;
        }
        
        .feature-content h3 {
            font-size: 1.3rem;
            margin-bottom: 0.5rem;
            font-weight: 700;
        }
        
        .feature-content p {
            color: var(--text-light);
            font-size: 1rem;
            line-height: 1.6;
        }
    </style>
</head>
<body>
    <nav>
        <div class="container">
            <a href="{{ url_for('index') }}" class="logo">NC ELECTIONS TRANSPARENCY</a>
            <ul class="nav-links">
                <li><a href="{{ url_for('index') }}#about">About</a></li>
                <li><a href="{{ url_for('index') }}#data">Data</a></li>
                <li><a href="{{ url_for('voting_info') }}">Voting Info</a></li>
            </ul>
        </div>
    </nav>

    <header class="page-header">
        <div class="container">
            <div class="breadcrumb">
                <a href="{{ url_for('index') }}">‚Üê Back to Home</a>
            </div>
            <h1>Interactive County Map</h1>
            <p class="tagline">Explore voter registration data across NC's 100 counties</p>
        </div>
    </header>

    <main>
        <section class="detail-section">
            <div class="container">
                <div class="layer-selector">
                    <h2>Select Data Layer</h2>
                    <p>Choose what data to visualize on the map:</p>
                    <div class="layer-buttons">
                        <a href="{{ url_for('interactive_map', layer='total') }}" 
                           class="layer-btn {% if layer == 'total' %}active{% endif %}">
                            Total Voters
                        </a>
                        <a href="{{ url_for('interactive_map', layer='unregistered') }}" 
                            class="layer-btn {% if layer == 'unregistered' %}active{% endif %}">
                            Eligible but Unregistered
                        </a>
                        <a href="{{ url_for('interactive_map', layer='party') }}" 
                           class="layer-btn {% if layer == 'party' %}active{% endif %}">
                            Partisan Affiliation
                        </a>
                        <a href="{{ url_for('interactive_map', layer='race') }}" 
                           class="layer-btn {% if layer == 'race' %}active{% endif %}">
                            Race
                        </a>
                        <a href="{{ url_for('interactive_map', layer='gender') }}" 
                           class="layer-btn {% if layer == 'gender' %}active{% endif %}">
                            Gender
                        </a>
                    </div>
                </div>

                {% if map_exists %}
                <div class="map-container">
                    <iframe src="{{ url_for('serve_map', filename=map_filename) }}" 
                            class="map-frame"
                            title="Interactive Map"></iframe>
                </div>
                {% else %}
                <div class="alert alert-warning">
                    <strong>Map Not Available</strong>
                    <p>The interactive map for this layer has not been generated yet. Run the visualization scripts to create it.</p>
                </div>
                {% endif %}
            </div>
        </section>

        <section class="coming-soon">
            <div class="container">
                <h2>Understanding the Data</h2>
                <p>The data these maps represent is taken from the <a href="https://www.ncsbe.gov/results-data">NCSBE</a>, 
                    the <a href="https://worldpopulationreview.com/us-counties/north-carolina">World Population Review</a> for population data, 
                    and a <a href="https://southerncoalition.org/resources/missing-voters-report/">Southern Coalition for Social Justice</a> 2025 report on North Carolina's 'missing' voters. 
                </p>
                <h5>Note: Not all maps are scaled equally. 
                    For example, some maps may be scaled 0% to 100% of the population of a given county, while others may be scaled only 0% to 5%. 
                    Rescaling provides a visualization that better distinguishes between 
                    counties with relatively higher or lower percentages of registrants who identified with the selected measurement (ie 'Republican' or 'Male').
                    View the gradient information section on the right side of the map to see each map's scale. </h5>
                    <p></p>
                <ul>
                    <h3>Total Voters</h3>
                    <p> This map represents the total registered voters with a status of 'Active' or 'Inactive'. The other available
                        statuses are 'Denied', 'Removed', or 'Temporary', of which only 'Temporary' registrants are able to vote and are typically military or
                        overseas. Active and inactive registrants are eligible to vote in North Carolina elections. </p>
                    <h3>Eligible but Unregistered</h3>
                    <p> This map visualizes the Eligible Voting Population (EVP), or the population of people who are eligible to register to vote and vote in North Carolina, 
                        but do not appear in the voter file as Active or Inactive. These people either have not registered to vote, had their registration 
                        application rejected, or were removed from the voter file, but are still eligible to register to vote and vote in North Carolina. 
                        The EVP is a useful metric for measuring a true turnout rate as the different between the population of voters and the population of people who 
                        could vote. 
                    </p>
                    <h3>Partisan Affiliation</h3>
                    <p> These maps show the percentage of registrants in each county who chose on their voter registration application to affiliate 
                        with one of the registered political parties in North Carolina or as Unaffiliated (Independent of any political party). The current
                        registered political parties in North Carolina are: Democrat, Republican, Libertarian, and Green. Some voters registered with the Constitution
                        party remain in the voter file, but that party failed to renew its registration with the NCSBE. Statistics that 
                        show the total registrants for these parties and other information can be found on the <a href="{{ url_for('party_page') }}">Voter Demographics</a> page.
                    </p>
                    <h3>Race</h3>
                    <p>
                        This map shows the percentage of registrants in each county who identified with a race or ethnicity on their voter registration application, and 
                        those who did not (undesignated). The NC voter registration application includes seven racial categories: White, Black, Asian, Native American,
                        Pacific Islander, Multiracial, and Other. 
                    </p>
                    <h3>Gender</h3>
                    <p>This map shows the percentage of registrants in each county who identified with a gender on their voter registration application, and 
                        those who did not (undesignated). The NC voter registration application includes two gender categories: Male and Female. 
                    </p>
                </ul>
            </div>
        </section>
    </main>

    <footer>
        <div class="container">
            <p>
                Data source: 
                <a href="https://www.ncsbe.gov/" target="_blank" rel="noopener">
                    NC State Board of Elections
                </a>
            </p>
            <p>&copy; 2026 NC Elections Transparency Project</p>
        </div>
    </footer>
</body>
</html>